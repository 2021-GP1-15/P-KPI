@{ ViewData["Title"] = "الاحصائيات";}


<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/css/datepicker.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min.js"></script>

<style>
    #infoList {
        font-size: 9px;
        list-style-type: square;
        list-style-position: outside;
        margin: 12px;
        padding: 0;
        text-align: right !important;
    }

    .required:after {
        content: " *";
        color: red;
    }

    .chart-container {
        position: relative;
        margin: 2%;
        margin-right: 4%;
        height: 35vh;
        display: flex;
        border: 3px solid #dee2e6;
        background-color: #ffffff;
        opacity: 0.8;
    }

    .chart-container-main {
        position: relative;
        margin: 2%;
        margin-right: 4%;
        height: 35vh;
        border: 3px solid #dee2e6;
        background-color: #ffffff;
        opacity: 0.8;
    }
    .contt {
        display: flex;
        flex-direction: row;
        flex-flow: wrap
    }
</style>

@*info buttun *@
<div class=" contt justify-content-start">
    <button class="btn rounded-0  " id="info" style="  background-color: #0084BD; color: #fff; ">
        تعليمات
    </button>
    <div id="minfo" class="card text-right " style="z-index:200; position:absolute; right:60px">
    </div>
</div>


<div class="container-fluid">
    <div class="row">
        <div class="col-md-2">
            <nav class=" navbar-expand-md ">
                <!-- Brand -->
                <!-- Toggler/collapsibe Button -->
                <button class="navbar-toggler " type="button" data-toggle="collapse" data-target="#collapsibleNavbar" aria-controls="collapsibleNavbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-funnel-fill" viewBox="0 0 16 16">
                            <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2z" />
                        </svg>
                    </span>
                </button>

                <!-- Navbar links -->
                <div class="collapse navbar-collapse  " id="collapsibleNavbar">
                    <div id="filter" class=" text-center ">
                        <form class=" bg-dark " style="float: right; text-align: right; border: 3px solid #dee2e6; padding: 15px 10px 15px 20px; color: white; ">
                            <p>اعرض الرسوم البيانية على حسب:</p>
                            <!-- Fillter code-->
                            <!-- KPI Option -->

                            <label class="small required">اختر المؤشر:</label>
                            <select onchange="enable()" name="KPI" id="KPI" class="form-control form-control-sm">
                                <option value="null" selected disabled>اختر</option>
                                @foreach (Kpi x in ViewBag.KPI)
                                {
                                    @if (x.Kpicode == "KPI-P-06-B")
                                    {
                                        continue;
                                    }
                                    <option value="@x.Kpicode">@x.Kpicode: @x.Description</option>
                                }
                            </select>

                            <!-- College Option -->
                            <label hidden class="small required college">اختر الكلية:</label>
                            <select hidden id="college" name="college" onchange="ChangeDepartments(); filterSelected();" class="form-control form-control-sm college">
                                <option value="null" selected disabled>اختر</option>
                                @foreach (College x in ViewBag.Colleges)
                                {
                                    <option value="@x.CollegeId">@x.CollageName</option>
                                }
                            </select>

                            <!-- Department Option -->
                            <label hidden class="department small required">اختر القسم:</label>
                            <select hidden id="department" onchange="ChangePrograms(); filterSelected();" name="department" class="form-control form-control-sm department">
                                <option value="null" selected>اختر</option>
                            </select>

                            <!-- Program Option -->
                            <label hidden class="program small required">اختر البرنامج:</label>
                            <select hidden name="program" id="program" onchange="filterSelected()" class="form-control form-control-sm program">
                                <option value="null" selected>اختر</option>
                            </select>

                            <!-- Year Option -->
                            <label hidden class="datepicker small required">اختر السنة:</label>
                            <input hidden onchange="filterSelected()" class="form-control form-control-sm datepicker " type="number" name="datepicker" placeholder="اختر" id="datepicker" />
                            <script>
                                var year1 = "";
                                $("#datepicker").datepicker({
                                    format: "yyyy",
                                    viewMode: "years",
                                    minViewMode: "years",
                                    autoclose: true //to close picker once year is selected
                                });
                                //to assign the picker value
                                $("#datepicker").on("change", function () {
                                    var selected = $(this).val();
                                    year1 = selected;
                                });
                            </script>

                            <!-- Term Option -->
                            <label hidden id="termLabel" class="small term">اختر الفصل الدراسي:</label>
                            <select hidden onchange="filterSelected()" class="form-control form-control-sm term" id="term" name="term">
                                <option value="null" selected disabled>اختر</option>
                                <option value="0">الكل</option>
                                <option value="الفصل الدراسي الاول">الفصل الاول</option>
                                <option value="الفصل الدراسي الثاني">الفصل الثاني</option>
                                <option value="الفصل الدراسي الثالث">الفصل الثالث</option>
                                <option value="الفصل الدراسي الصيفي">الفصل الصيفي</option>
                            </select>

                            <!-- Gender Option -->
                            <label hidden class="small Gender">اختر الجنس:</label>
                            <select hidden name="Gender" id="Gender" class="form-control form-control-sm Gender">
                                <option value="0" selected>الكل</option>
                                <option value="انثى">انثى</option>
                                <option value="ذكر">ذكر</option>
                            </select>

                            <!-- Nationality Option -->
                            <label hidden class="small nationality">اختر الجنسية:</label>
                            <select hidden name="nationality" id="nationality" class="form-control form-control-sm nationality">
                                <option value="0" selected>الكل</option>
                                <option value="سعودي">سعودي</option>
                                <option value="غير سعودي">غير سعودي</option>
                            </select>

                            <!-- Case Option -->
                            <label hidden class="small case">اختر الحالة:</label>
                            <select hidden name="case" id="case" class="form-control form-control-sm case">
                                <option value="0" selected>الكل</option>
                                <option value="طبيعي">طبيعي</option>
                                <option value="احتياجات خاصة">احتياجات خاصة</option>
                            </select>

                            <!-- buttons -->
                            <br />
                            <button class="btn btn-block text-white btn-sm shadow" style="background-color: #0084BD" disabled onclick="ShowGraphs(); " id="show" data-toggle="button" aria-pressed="false">عرض التقارير</button>

                        </form>
                    </div>
                </div>

            </nav>
        </div>
        @* end of info buttun *@

        <!-- Filter End -->
        <!-- Charts Area -->
       <div class="" id="ch"></div>
            <div class="col-md-10 ">
                <fieldset id="charts">

                    <div id="toAppendWith">

                        <div id='cards'></div>

                    </div>
                </fieldset>
            </div>
        </div>
    </div>
</div>
@* Refrence for chart.js styling https://www.youtube.com/channel/UCojXvfr41NqDxaPb9amu8-A*@
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.0.0-rc.1/chartjs-plugin-datalabels.min.js" integrity="sha512-+UYTD5L/bU1sgAfWA0ELK5RlQ811q8wZIocqI7+K0Lhh8yVdIoAMEs96wJAIbgFvzynPm36ZCXtkydxu1cs27w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.0.0/chartjs-plugin-datalabels.min.js" integrity="sha512-R/QOHLpV1Ggq22vfDAWYOaMd5RopHrJNMxi8/lJu8Oihwi4Ho4BRFeiMiCefn9rasajKjnx9/fTQ/xkWnkDACg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/patternomaly/1.3.2/patternomaly.js" integrity="sha512-gNM40ajr/bSi3Af8i6D4dV2CUWZrkm2zhgeWf46H91zOwWoH8Wwsyf6kQ4syfNyOrnjATrjKkP4ybWD7eKp2KA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    $(document).ready(function () {
        $("#info").click(function () {
            $("#minfo").html("<small>  تعليمات الاستخدام <ol class= 'card-text '>  <li> اختر من الفلتر نوع المؤشر.  </li><li> اختر الخيارات الالزامية التي تحتوي على نجمة حمراء.  </li><li>اختر مايناسبك من الخيارات المتبقية.  </li> <li> اضغط على زر عرض التقارير لعرض النتائج. </li> </ol> </small>").toggle();
        })
    });


    $(window).on('resize', function () {
        if ($(window).width() < 800) {
            alert("لتظهر الرسومات بشكل اوضح نرجوا استعمال جهاز بشاشة اكبر");
            $('#collapsibleNavbar').css({ 'z-index': '100', 'position': 'absolute' });
            $('#ch').addClass("container-fluid");
           
        }
        else {
            $('#collapsibleNavbar').css({ 'z-index': '0', 'position': 'static' });
            $('#ch').removeClass("container-fluid");
        };
    });

    //to enable the filter option based on the choosen KPI
    function enable() {
        var KPICode = $('#KPI :selected').val();
        var college = document.getElementsByClassName("college");
        var department = document.getElementsByClassName("department");
        var program = document.getElementsByClassName("program");
        var gender = document.getElementsByClassName("Gender")
        var nationality = document.getElementsByClassName("nationality");
        var studentCase = document.getElementsByClassName("case");
        var term = document.getElementsByClassName("term");
        var year = document.getElementsByClassName("datepicker");

        //filter with student details and term
        if (KPICode == "KPI-P-02" || KPICode == "KPI-P-03") {
            for (var i = 0; i < 2; i++) {
                college[i].hidden = false;
                department[i].hidden = false;
                program[i].hidden = false;
                gender[i].hidden = false;
                nationality[i].hidden = false;
                studentCase[i].hidden = false;
                term[i].hidden = false;
                year[i].hidden = false;
            }
            document.getElementById("termLabel").classList.add("required");
        }

        //filter with student details and without term
        if (KPICode == "KPI-P-10" || KPICode == "KPI-P-17") {
            for (var i = 0; i < 2; i++) {
                college[i].hidden = false;
                department[i].hidden = false;
                program[i].hidden = false;
                gender[i].hidden = false;
                nationality[i].hidden = false;
                studentCase[i].hidden = false;
                term[i].hidden = true;
                year[i].hidden = false;
            }
            document.getElementById("termLabel").classList.remove("required");
        }

        //filter without student details and term
        if (KPICode == "KPI-P-04" || KPICode == "KPI-P-05" || KPICode == "KPI-P-06" || KPICode == "KPI-P-07" || KPICode == "KPI-P-09" || KPICode == "KPI-P-11" || KPICode == "KPI-P-12" || KPICode == "KPI-P-13" || KPICode == "KPI-P-14" || KPICode == "KPI-P-15" || KPICode == "KPI-P-16") {
            for (var i = 0; i < 2; i++) {
                college[i].hidden = false;
                department[i].hidden = false;
                program[i].hidden = false;
                gender[i].hidden = false;
                nationality[i].hidden = true;
                studentCase[i].hidden = true;
                term[i].hidden = true;
                year[i].hidden = false;
            }
            document.getElementById("termLabel").classList.remove("required");
        }
        //filter without student details
        if (KPICode == "KPI-P-08") {
            for (var i = 0; i < 2; i++) {
                college[i].hidden = false;
                department[i].hidden = false;
                program[i].hidden = false;
                gender[i].hidden = false;
                nationality[i].hidden = true;
                studentCase[i].hidden = true;
                term[i].hidden = false;
                year[i].hidden = false;
            }
            document.getElementById("termLabel").classList.add("required");
        }
    }

    function filterSelected() {
        var KPICode = $('#KPI :selected').val();
        var college = $('#college :selected').val();
        var department = $('#department :selected').val();
        var program = $('#program :selected').val();
        var term = $('#term :selected').val();
        var year = year1.toString();

        //with term option
        if (KPICode == "KPI-P-02" || KPICode == "KPI-P-03" || KPICode == "KPI-P-08") {
            if (KPICode != "null" && college != "null" && department != "null" && program != "null" && term != "null" && year != "") {
                document.getElementById("show").disabled = false;
                console.log("enterd");
            }
        }
        //without term option
        else if (KPICode == "KPI-P-04" || KPICode == "KPI-P-05" || KPICode == "KPI-P-06" || KPICode == "KPI-P-07" || KPICode == "KPI-P-09" || KPICode == "KPI-P-10" || KPICode == "KPI-P-11" || KPICode == "KPI-P-12" || KPICode == "KPI-P-13" || KPICode == "KPI-P-14" || KPICode == "KPI-P-15" || KPICode == "KPI-P-16" || KPICode == "KPI-P-17") {
            if (KPICode != "null" && college != "null" && department != "null" && program != "null" && year != "") {
                document.getElementById("show").disabled = false;
                console.log("enterd");
            }
        }

    }

    function splitText(text, count) {
        if (text.length < count)
            return text;
        return text.slice(0, count);
    }

    function ChangeDepartments() {
        var college = $('#college :selected').val();
        $.ajax({
            type: "GET",
            url: "/Home/GetDepartments",
            data: { collegeId: college },
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $('#department')
                    .find('option')
                    .remove()
                    .end()
                    .append('<option value="null" selected>اختر</option>')
                    .val('');
                for (var i = 0; i < data.length; i++) {
                    $("#department").append('<option value= "' + data[i].departmentId + '">' + data[i].departmentName + '</option>');
                }
            },
            error: function () {
                alert("حدث خطأ ما")
            }
        });
    }

    function ChangePrograms() {
        var departmentId = $('#department :selected').val();
        $.ajax({
            type: "GET",
            url: "/Home/GetPrograms",
            data: { departmentId: departmentId },
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $('#program')
                    .find('option')
                    .remove()
                    .end()
                    .append('<option value="null" selected>اختر</option>')
                    .val('');
                for (var i = 0; i < data.length; i++) {
                    $("#program").append('<option value= "' + data[i].programId + '">' + data[i].level + " " + data[i].programName + '</option>');
                }
            },
            error: function () {
                alert("حدث خطأ ما")
            }
        });
    }

    function deleteWelcomePage() {
        $('#welcomeCards').remove();
    }

    function ShowGraphs() {
        var programId = $('#program :selected').val();
        var KPICode = $('#KPI :selected').val();
        var gender = $('#Gender :selected').val();
        var term = $('#term :selected').val();
        var year = year1.toString();
        var studentCase = $('#case :selected').val();
        var nationality = $('#nationality :selected').val();
        var ctx;
        var myChart;
        var ActualValueLabels = ["القيمة الفعلية اقل  باكثر من 10% من الاداء المستهدف", "القيمة الفعلية اقل  بمقدار 10% من الاداء المستهدف", "القيمة الفعلية تساوي الاداء المستهدف او اعلى منه بمقدار 10%", "القيمة الفعلية اعلى  باكثر من 10% من الاداء المستهدف"];
        var ActualValueColors = ["#C1272D", "#F7931E", "#71BA44", "#29B8BE"];
        var ActualValueStyles = ["weave", "cross", "line-vertical", "dot"];
        const lollipopChart = {
            id: 'lollipopChart',
            afterDatasetsDraw(chart, args, options) {
                const { ctx } = chart;
                ctx.save();

                for (let i = 0; i < chart.getDatasetMeta(0).data.length; i++) {
                    const x = chart.getDatasetMeta(0).data[i].x;
                    const y = chart.getDatasetMeta(0).data[i].y;
                    let borderColor;
                    if (chart.isDatasetVisible(0) === true)
                        borderColor = chart.getDatasetMeta(0)._dataset.backgroundColor[i];
                    else
                        borderColor = 'transparent';

                    const angle = Math.PI / 180;
                    ctx.beginPath();
                    ctx.fillStyle = borderColor;
                    ctx.arc(x, y, 15, angle * 0, angle * 360, false);
                    ctx.fill();
                    ctx.closePath();
                    ctx.restore()
                }
            }
        }

        if (KPICode == "KPI-P-02" || KPICode == "KPI-P-03") {
            $.ajax({
                type: "Get",
                url: "/Home/GetSurveyChart",
                data: { programId: programId, KPICode: KPICode, gender: gender, term: term, year: year, studentCase: studentCase, nationality: nationality },
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var barColor = []; var barGender = []; var barScore = []; var progName = []; var numOfStudent = []; var chapeOfFourValue = [];
                    for (var i = 0; i < data.length; i++) {
                        barGender.push(data[i].gender);
                        barColor.push(data[i].nationality);
                        barScore.push(data[i].term);
                        splitText(barScore[i], 4);
                        progName.push(data[i].studentCase);
                        numOfStudent.push(data[i].programId);
                        chapeOfFourValue.push(data[i].year);
                    }
                    //prepare the area
                    $('#cards').remove();
                    $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div><div class='row'><div class= 'chart-container col-md-11'><div class='col-md-6'><canvas id='caseGraph'></canvas></div><div class='col-md-6'><canvas id='nationalityGraph'></canvas></div></div ></div ><br/><div class='row'><div id='hideIf14' class='chart-container col-md-11'><div class='col-md-6'> <canvas id='genderGraph'></canvas> </div><div class='col-md-6'>  <canvas id='termGraph'></canvas></div></div></div></div>");

                    ctx = document.getElementById("termGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 1.0,
                                    max: 5.0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false,
                                },
                                title: {
                                    display: true,
                                    text: 'نسبة رضا الطلاب من حيث الفصول'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد المجيبين: ${numOfStudent[context[0].dataIndex]} `;
                                        },
                                        footer: function (context) {
                                            return ` متوسط نتائج المجيبين على الاستبانة: ${barScore[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(0, 5), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(0, 5), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: barColor.slice(0, 5),
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("caseGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 1.0,
                                    max: 5.0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false,
                                },
                                title: {
                                    display: true,
                                    text: 'نسبة رضا الطلاب من حيث الحالة'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد المجيبين: ${numOfStudent.slice(5, 7)[context[0].dataIndex]} `;
                                        },
                                        footer: function (context) {
                                            return ` متوسط نتائج المجيبين على الاستبانة: ${barScore.slice(5, 7)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(5, 7), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(5, 7), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: barColor.slice(5, 7),
                                    //   borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("genderGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 1.0,
                                    max: 5.0,
                                    stacked: true,
                                    grid: {
                                        display: true

                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'نسبة رضا الطلاب من حيث الجنس'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد المجيبين: ${numOfStudent.slice(7, 10)[context[0].dataIndex]} `;
                                        },
                                        footer: function (context) {
                                            return ` متوسط نتائج المجيبين على الاستبانة: ${barScore.slice(7, 10)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(7, 10), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(7, 10), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: barColor.slice(7, 10),
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("nationalityGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 1.0,
                                    max: 5.0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'نسبة رضا الطلاب من حيث الجنسية'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد المجيبين: ${numOfStudent.slice(10, 12)[context[0].dataIndex]} `;
                                        },
                                        footer: function (context) {
                                            return ` متوسط نتائج المجيبين على الاستبانة: ${barScore.slice(10, 12)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(10, 12), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(10, 12), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: barColor.slice(10, 12),
                                    //borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false,
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("target"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 1.0,
                                    max: 5.0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        generateLabels: (chart) => {
                                            console.log(chart);
                                            //let visibility = [];
                                            //for (let i = 0; i < chart.data.label.length; i++)
                                            return ActualValueLabels.map(
                                                (label = ActualValueLabels, index) => ({
                                                    text: label,
                                                    fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                })
                                            )
                                        }

                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'المقارنة بين الاربع قيم لمستوى رضا الطلاب عن البرنامج'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        footer: function (context) {
                                            return ` متوسط النتائج: ${barScore.slice(12)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [lollipopChart],
                        data: {
                            labels: barGender.slice(12), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(12), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        pattern.draw(chapeOfFourValue[12], barColor[12]),
                                        barColor[13],
                                        barColor[14],
                                        barColor[15]
                                    ],
                                    borderColor: "rgb(0,204,204)",
                                    //borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false,
                                    barPercentage: 0.05
                                }
                            ]
                        }
                    });
                },
                error: function () {
                    alert(" القيم المختارة غير موجودة في قاعدة البيانات، الرجاء اعادة المحاولة")
                }
            });
        }

        if (KPICode == "KPI-P-06" || KPICode == "KPI-P-07" || KPICode == "KPI-P-09") {
            $.ajax({
                type: "Get",
                url: "/Home/GetAlumniChart",
                data: { programId: programId, KPICode: KPICode, gender: gender, year: year },
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var barColor = []; var barGender = []; var barScore = []; var progName = []; var numOfStudent = []; var chapeOfFourValue = [];
                    for (var i = 0; i < data.length; i++) {
                        barGender.push(data[i].gender);
                        barColor.push(data[i].nationality);
                        barScore.push(data[i].term);
                        splitText(barScore[i], 4);
                        progName.push(data[i].studentCase);
                        numOfStudent.push(data[i].programId);
                        chapeOfFourValue.push(data[i].year);
                    }
                    var numOfStudentEmployed = [chapeOfFourValue[4], numOfStudent[0] - chapeOfFourValue[4]];
                    var numOfStudentEnrolled = [chapeOfFourValue[6], numOfStudent[0] - chapeOfFourValue[6]];
                    var numOfStudentPassedQiyas = [chapeOfFourValue[10], numOfStudent[0] - chapeOfFourValue[10]];
                    var numOfStudentPassedCareer = [chapeOfFourValue[12], numOfStudent[0] - chapeOfFourValue[12]];

                    if (KPICode == "KPI-P-06") {
                        $('#cards').remove();
                        $('#toAppendWith').append("<div id='cards'><br /><h3 class='text-center'>تحليل مؤشر اختبار قياس لقدرات الجامعيين</h3><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div><div class='row'><div class= 'chart-container col-md-11'><div class='col-md-6'><canvas id = 'caseGraph' ></canvas ></div > <div class='col-md-6'><canvas id='nationalityGraph'></canvas></div></div ></div ><br/><h3 class='text-center'>تحليل مؤشر الاختبار المهني المتخصص</h3><div class='row'><div class='chart-container-main col-md-11'><canvas id='target2'></canvas></div></div><div class='row'><div id='hideIf14' class='chart-container col-md-11'><div class='col-md-6'> <canvas id='genderGraph'></canvas> </div><div class='col-md-6'>  <canvas id='termGraph'></canvas></div></div></div></div > ");

                        ctx = document.getElementById("target"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'bar',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            generateLabels: (chart) => {
                                                return ActualValueLabels.map(
                                                    (label = ActualValueLabels, index) => ({
                                                        text: label,
                                                        fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                    })
                                                )
                                            }

                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'المقارنة بين الاربع قيم لنسبة الخريجين المجتازين اختبار قياس لقدرات الجامعيين'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: (context) => {
                                                if (context[0].dataIndex == 0) {
                                                    return ` العدد الكلي للخريجين: ${numOfStudent[context[0].dataIndex]} `;
                                                }
                                                return '';
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين: ${barScore.slice(0, 4)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            plugins: [lollipopChart],
                            data: {
                                labels: barGender.slice(0, 4), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(0, 4), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw(chapeOfFourValue[0], barColor[0]),
                                            barColor[1],
                                            barColor[2],
                                            barColor[3]
                                        ],
                                        borderColor: "rgb(0,204,204)",
                                        //borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false,
                                        barPercentage: 0.05
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("target2"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'bar',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            generateLabels: (chart) => {
                                                console.log(chart);
                                                //let visibility = [];
                                                //for (let i = 0; i < chart.data.label.length; i++)
                                                return ActualValueLabels.map(
                                                    (label = ActualValueLabels, index) => ({
                                                        text: label,
                                                        fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                    })
                                                )
                                            }

                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'المقارنة بين الاربع قيم لنسبة الخريجين المجتازين للاختبار المهني المتخصص'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: (context) => {
                                                if (context[0].dataIndex == 0) {
                                                    return ` العدد الكلي للخريجين: ${numOfStudent[context[0].dataIndex]} `;
                                                }
                                                return '';
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين: ${barScore.slice(14, 18)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            plugins: [lollipopChart],
                            data: {
                                labels: barGender.slice(14, 18), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(14, 18), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw(chapeOfFourValue[14], barColor[14]),
                                            barColor[15],
                                            barColor[16],
                                            barColor[17]
                                        ],
                                        borderColor: "rgb(0,204,204)",
                                        //borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false,
                                        barPercentage: 0.05
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("termGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        },
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة الخريجين المجتازين الاختبار المهني المتخصص من حيث الجنس'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الخريجين: ${numOfStudent.slice(12, 14)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين: ${barScore.slice(12, 14)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(12, 14), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(12, 14), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[12],
                                            pattern.draw("dot", barColor[13])
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("nationalityGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة الخريجين المجتازين اختبار قياس لتقويم قدرات الخريجين من حيث الجنس'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الخريجين: ${numOfStudent.slice(10, 12)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين: ${barScore.slice(10, 12)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(10, 12), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(10, 12), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[10],
                                            pattern.draw("dot", barColor[11])
                                        ],
                                        //   borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("caseGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true

                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة اجتياز الخريجين لاختبار قياس لتقويم قدرات الخريجين'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                console.log(context)
                                                return ` اعداد الخريجين: ${numOfStudentPassedQiyas[context[0].dataIndex]} `;
                                            },
                                            footer: (context) => {
                                                return ` نسبة الخريجين: ${context[0].parsed} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: ["عدد الخريجين الذين اجتازوا الاختبار", "عدد الخريجين الذين لم يجتازوا الاختبار"], //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: [(numOfStudentPassedQiyas[0] * 100) / numOfStudent[0], (numOfStudentPassedQiyas[1] * 100) / numOfStudent[0]], //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: ["#D0DA32", pattern.draw("dot", "#1F3771")],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("genderGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة اجتياز الخريجين للاختبار المهني المتخصص'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                console.log(context)
                                                return ` اعداد الخريجين: ${numOfStudentPassedCareer[context[0].dataIndex]} `;
                                            },
                                            footer: (context) => {
                                                return ` نسبة الخريجين: ${context[0].parsed} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: ["عدد الخريجين الذين اجتازوا الاختبار", "عدد الخريجين الذين لم يجتازوا الاختبار"], //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: [(numOfStudentPassedCareer[0] * 100) / numOfStudent[0], (numOfStudentPassedCareer[1] * 100) / numOfStudent[0]], //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: ["#D0DA32", pattern.draw("dot", "#1F3771")],
                                        //borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });
                    }
                    else if (KPICode == "KPI-P-07") {
                        //prepare the area
                        $('#cards').remove();
                        $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div><div class='row'><div class= 'chart-container col-md-11'><div class='col-md-6'><canvas id='caseGraph'></canvas></div><div class='col-md-6'><canvas id='nationalityGraph'></canvas></div></div ></div ><br/><div class='row'><div id='hideIf14' class='chart-container col-md-11'><div class='col-md-6'> <canvas id='genderGraph'></canvas> </div><div class='col-md-6'>  <canvas id='termGraph'></canvas></div></div></div><div class='row'><div class='chart-container-main col-md-11'><canvas id='ExtraActivityGraph'></canvas></div></div></div>");

                        ctx = document.getElementById("termGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        },
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة الخريجين الملتحقين ببرامج دراسات عليا من حيث الجنس'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الخريجين الملتحقين: ${numOfStudent.slice(6, 8)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين الملتحقين: ${barScore.slice(6, 8)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(6, 8), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(6, 8), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[6],
                                            pattern.draw(chapeOfFourValue[7], barColor[7])
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("nationalityGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة الخريجين الموظفين من حيث الجنس'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الخريجين الموظفين: ${numOfStudent.slice(4, 6)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين الموظفين: ${barScore.slice(4, 6)[context[0].dataIndex]}% `;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(4, 6), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(4, 6), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[4],
                                            pattern.draw(chapeOfFourValue[5], barColor[5])
                                        ],                                        //   borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("caseGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true

                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة توظيف الخريجين'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                console.log(context)
                                                return ` اعداد الخريجين: ${numOfStudentEmployed[context[0].dataIndex]} `;
                                            },
                                            footer: (context) => {
                                                return ` نسبة الخريجين: ${context[0].parsed} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: ["عدد الخريجين الذين توظفوا", "عدد الخريجين الذين لم يتوظفوا"], //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: [(numOfStudentEmployed[0] * 100) / numOfStudent[0], (numOfStudentEmployed[1] * 100) / numOfStudent[0]], //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            "#D0DA32",
                                            pattern.draw(chapeOfFourValue[7], "#1F3771")
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("genderGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة التحاق الخريجين ببرامج دراسات عليا'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                console.log(context)
                                                return ` اعداد الخريجين: ${numOfStudentEnrolled[context[0].dataIndex]} `;
                                            },
                                            footer: (context) => {
                                                return ` نسبة الخريجين: ${context[0].parsed} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: ["عدد الخريجين الملتحقين", "عدد الخريجين الذين لم يلتحقوا"], //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: [(numOfStudentEnrolled[0] * 100) / numOfStudent[0], (numOfStudentEnrolled[1] * 100) / numOfStudent[0]], //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            "#D0DA32",
                                            pattern.draw(chapeOfFourValue[7], "#1F3771")
                                        ],
                                        //borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("target"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'bar',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            generateLabels: (chart) => {
                                                console.log(chart);
                                                //let visibility = [];
                                                //for (let i = 0; i < chart.data.label.length; i++)
                                                return ActualValueLabels.map(
                                                    (label = ActualValueLabels, index) => ({
                                                        text: label,
                                                        fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                    })
                                                )
                                            }

                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'المقارنة بين الاربع قيم لنسبة الخريجين الملتحقين ببرامج دراسات عليا او الموظفين في اول سنة من تخرجهم'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: (context) => {
                                                if (context[0].dataIndex == 0) {
                                                    return ` العدد الكلي للخريجين: ${numOfStudent[context[0].dataIndex]} `;
                                                }
                                                return '';
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين الموظفين والملتحقين: ${barScore.slice(0, 4)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            plugins: [lollipopChart],
                            data: {
                                labels: barGender.slice(0, 4), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(0, 4), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw(chapeOfFourValue[0], barColor[0]),
                                            barColor[1],
                                            barColor[2],
                                            barColor[3]
                                        ],
                                        borderColor: "rgb(0,204,204)",
                                        //borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false,
                                        barPercentage: 0.05
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("ExtraActivityGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        },
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة الخريجين المشاركين بالانشطة اللاصفية'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الخريجين: ${numOfStudent.slice(18, 20)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة الخريجين: ${barScore.slice(18, 20)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(18, 20), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(18, 20), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[18],
                                            pattern.draw(chapeOfFourValue[19], barColor[19])
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                    }
                    else {
                        //prepare the KPI-09 area
                        $('#cards').remove();
                        $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div></div>");
                        $('#cards').append("<div class='row'><div class= 'chart-container-main col-md-11'><canvas id='nationalityGraph'></canvas></div></div >");

                        //drow KPI-09 graph
                        ctx = document.getElementById("nationalityGraph"); //where
                        myChart = new Chart(ctx, {
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        stacked: true,
                                        grid: {
                                            display: true

                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'تقويم جهات التوظيف لكفاءات الخريجين من حيث الجنس'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            footer: function (context) {
                                                return ` متوسط التقويم: ${barScore.slice(8, 10)[context[0].dataIndex]} `;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(8, 10), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(8, 10), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[8],
                                            pattern.draw("dot", barColor[9])
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        //  fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("target"); //where in HTML
                        myChart = new Chart(ctx, { /* chart */
                            type: 'bar',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            generateLabels: (chart) => {
                                                return ActualValueLabels.map(
                                                    (label = ActualValueLabels, index) => ({
                                                        text: label,
                                                        fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                    })
                                                )
                                            }

                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'المقارنة بين الاربع قيم لمعدل تقويم جهات التوظيف لكفاءات الخريجين'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: (context) => {
                                                if (context[0].dataIndex == 0) {
                                                    return ` العدد الكلي للخريجين: ${numOfStudent[context[0].dataIndex]} `;
                                                }
                                                return '';
                                            },
                                            afterFooter: (context) => {
                                                return `  معدل التقويم: ${context[0].parsed.y} `
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            plugins: [lollipopChart],
                            data: {
                                labels: barGender.slice(0, 4), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(0, 4), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw(chapeOfFourValue[0], barColor[0]),
                                            barColor[1],
                                            barColor[2],
                                            barColor[3]
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false,
                                        barPercentage: 0.05
                                    }
                                ]
                            }
                        });
                    }
                },
                error: function () {
                    alert(" القيم المختارة غير موجودة في قاعدة البيانات، الرجاء اعادة المحاولة")
                }
            });
        }

        if (KPICode == "KPI-P-08") {

            $.ajax({
                type: "Get",
                url: "/Home/GetClassSectionChart",
                data: { programId: programId, KPICode: KPICode, gender: gender, term: term, year: year },
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var barColor = []; var barGender = []; var barScore = []; var progName = []; var numOfStudent = []; var numOfclasses = [];
                    for (var i = 0; i < data.length; i++) {
                        barGender.push(data[i].gender);
                        barColor.push(data[i].nationality);
                        barScore.push(data[i].term);
                        progName.push(data[i].studentCase);
                        numOfStudent.push(data[i].programId);
                        numOfclasses.push(data[i].year);
                    }

                    //prepare the common area
                    $('#cards').remove();
                    $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div></div>");
                    $('#cards').append("<div class='row'><div class= 'chart-container-main col-md-11'><canvas id='nationalityGraph'></canvas></div></div >");

                    //drow KPI-08 graph
                    ctx = document.getElementById("nationalityGraph"); //where
                    myChart = new Chart(ctx, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    stacked: false,
                                    grid: {
                                        display: true

                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        usePointStyle: true
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'معدل الطلاب في الشعبة'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________'
                                        },
                                        beforeFooter: (context) => {
                                            return `  اعداد الطلبة في الشعبة الواحدة: ${context[0].parsed.y} `
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(4, 9), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(4, 9), //y-axis
                                    label: "اناث", //the upper chart filter
                                    backgroundColor: barColor.slice(4, 9),
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                },
                                {
                                    data: barScore.slice(9, 14), //y-axis
                                    label: "ذكور", //the upper chart filter
                                    backgroundColor: barColor.slice(9, 14),
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("target"); //where in HTML
                    myChart = new Chart(ctx, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        generateLabels: (chart) => {
                                            console.log(chart);
                                            //let visibility = [];
                                            //for (let i = 0; i < chart.data.label.length; i++)
                                            return ActualValueLabels.map(
                                                (label = ActualValueLabels, index) => ({
                                                    text: label,
                                                    fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                })
                                            )
                                        }

                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'المقارنة بين الاربع قيم لمعدل الطلاب في الشعبة الواحدة'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: (context) => {
                                            if (context[0].dataIndex == 0) {
                                                return ` العدد الكلي للطلبة: ${numOfStudent[context[0].dataIndex]} `;
                                            }
                                            return '';
                                        },
                                        footer: (context) => {
                                            if (context[0].dataIndex == 0) {
                                                return ` العدد الكلي للشعب: ${numOfclasses[context[0].dataIndex]} `;
                                            }
                                            return '';
                                        },
                                        afterFooter: (context) => {
                                            return `  اعداد الطلبة في الشعبة الواحدة: ${context[0].parsed.y} `
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [lollipopChart],
                        data: {
                            labels: barGender.slice(0, 4), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(0, 4), //y-axis
                                    label: progName[1], //the upper chart filter
                                    backgroundColor: [
                                        pattern.draw(progName[0], barColor[0]),
                                        barColor[1],
                                        barColor[2],
                                        barColor[3]
                                    ],
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false,
                                    barPercentage: 0.05
                                }
                            ]
                        }
                    });

                },
                error: function () {
                    alert(" القيم المختارة غير موجودة في قاعدة البيانات، الرجاء اعادة المحاولة")
                }
            });
        }

        if (KPICode == "KPI-P-10" || KPICode == "KPI-P-17") {
            $.ajax({
                type: "Get",
                url: "/Home/GetResorcesChart",
                data: { programId: programId, KPICode: KPICode, gender: gender, year: year, studentCase: studentCase, nationality: nationality },
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var barColor = []; var barGender = []; var barScore = []; var progName = []; var numOfStudent = []; var chapeOfFourValue = [];
                    for (var i = 0; i < data.length; i++) {
                        barGender.push(data[i].gender);
                        barColor.push(data[i].nationality);
                        barScore.push(data[i].term);
                        splitText(barScore[i], 4);
                        progName.push(data[i].studentCase);
                        numOfStudent.push(data[i].programId);
                        chapeOfFourValue.push(data[i].year);
                    }
                    //prepare the area
                    $('#cards').remove();
                    $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div><div class='row'><div id='hideIf14' class='chart-container col-md-11'><div class='col-md-6'> <canvas id='genderGraph'></canvas> </div><div class='col-md-6'>  <canvas id='termGraph'></canvas></div></div></div></div>");

                    ctx = document.getElementById("target"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 1.0,
                                    max: 5.0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        generateLabels: (chart) => {
                                            console.log(chart);
                                            //let visibility = [];
                                            //for (let i = 0; i < chart.data.label.length; i++)
                                            return ActualValueLabels.map(
                                                (label = ActualValueLabels, index) => ({
                                                    text: label,
                                                    fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                })
                                            )
                                        }

                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'المقارنة بين الاربع قيم لمستوى رضا المستخدمين عن الموارد'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        footer: function (context) {
                                            return ` متوسط النتائج: ${barScore.slice(0,4)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [lollipopChart],
                        data: {
                            labels: barGender.slice(0,4), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(0, 4), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        pattern.draw(chapeOfFourValue[0], barColor[0]),
                                        barColor[1],
                                        barColor[2],
                                        barColor[3]
                                    ],
                                    borderColor: "rgb(0,204,204)",
                                    //borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false,
                                    barPercentage: 0.05
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("genderGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    stacked: true,
                                    grid: {
                                        display: true

                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: ' عدد الطلاب من حيث الجنس'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد المجيبين: ${numOfStudent.slice(12, 14)[context[0].dataIndex]} `;
                                        },
                                        footer: function (context) {
                                            return ` متوسط نتائج المجيبين على الاستبانة: ${barScore.slice(12, 14)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(12, 14), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: numOfStudent.slice(12, 14), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: barColor.slice(12, 14),
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("termGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'pie',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        usePointStyle: true
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'اعداد الطلاب المقيمين من حيث مستوى رضاهم'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        title: (context) => {
                                            return `${context[0].label}`;
                                        },
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد المجيبين: ${barScore.slice(4,8)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(4, 8), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(4, 8), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        pattern.draw("dot", "#D0DA32"),
                                        pattern.draw("ring", "#71BA44"),
                                        pattern.draw("dash", "#29B8BE"),
                                        pattern.draw("cross", "#1F3771"),
                                    ],
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });


                    if (KPICode == "KPI-P-17") {
                        $('#cards').append("<br/><div class='row'><div class= 'chart-container col-md-11'><div class='col-md-6'><canvas id='caseGraph'></canvas></div><div class='col-md-6'><canvas id='nationalityGraph'></canvas></div></div ></div>");

                        ctx = document.getElementById("caseGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'bar',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        stacked: true,
                                        grid: {
                                            display: true

                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    title: {
                                        display: true,
                                        text: ' عدد الاعضاء من حيث الجنس'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد المجيبين: ${numOfStudent.slice(14, 16)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` متوسط نتائج المجيبين على الاستبانة: ${barScore.slice(14, 16)[context[0].dataIndex]} `;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(14, 16), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: numOfStudent.slice(14, 16), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: barColor.slice(14, 16),
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("nationalityGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        },
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'اعداد الاعضاء المقيمين من حيث مستوى رضاهم'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد المجيبين: ${barScore.slice(8, 12)[context[0].dataIndex]} `;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(8, 12), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(8, 12), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw("dot", "#D0DA32"),
                                            pattern.draw("ring", "#71BA44"),
                                            pattern.draw("dash", "#29B8BE"),
                                            pattern.draw("cross", "#1F3771"),
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });


                    }

                },
                error: function () {
                    alert(" القيم المختارة غير موجودة في قاعدة البيانات، الرجاء اعادة المحاولة")
                }
            });
        }

        if (KPICode == "KPI-P-11" || KPICode == "KPI-P-12" || KPICode == "KPI-P-13") {

            $.ajax({
                type: "Get",
                url: "/Home/GetFacultyStatisticsChart",
                data: { programId: programId, KPICode: KPICode, gender: gender, year: year },
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var barColor = []; var barGender = []; var barScore = []; var progName = []; var numOfStudent = []; var chapeOfFourValue = [];
                    for (var i = 0; i < data.length; i++) {
                        barGender.push(data[i].gender);
                        barColor.push(data[i].nationality);
                        barScore.push(data[i].term);
                        progName.push(data[i].studentCase);
                        numOfStudent.push(data[i].programId);
                        chapeOfFourValue.push(data[i].year);
                    }

                    //prepare the common area
                    $('#cards').remove();
                    $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div></div>");

                    if (KPICode == "KPI-P-11") {
                        //prepare the KPI-11 area
                        $('#cards').append("<div class='row'><div class= 'chart-container-main col-md-11'><canvas id='nationalityGraph'></canvas></div></div >");

                        for (var i = 0; i < barScore.length; i++) {
                            var splited = barScore[i].split('.');
                            barScore[i] = splited[0];
                        }

                        var header = ['عدد الطلاب', 'عضو هيئة تدريس']; var score_for11 = [barScore.slice(0, 1), 1];

                        //drow KPI-11 graph
                        ctx = document.getElementById("nationalityGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة كل عضو هيئة تدريس لاعداد الطلبة'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: function (context) {
                                                return `${header[context[0].dataIndex]} `;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            footer: function (context) {
                                                return ` عددهم: ${score_for11[context[0].dataIndex]} `;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: header, //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: score_for11, //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[0],
                                            pattern.draw("dot", barColor[1])
                                        ],
                                        //borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });
                    }

                    //drow the common graph for all the KPIs
                    ctx = document.getElementById("target"); //where in HTML
                    myChart = new Chart(ctx, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        generateLabels: (chart) => {
                                            console.log(chart);
                                            //let visibility = [];
                                            //for (let i = 0; i < chart.data.label.length; i++)
                                            return ActualValueLabels.map(
                                                (label = ActualValueLabels, index) => ({
                                                    text: label,
                                                    fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                })
                                            )
                                        }

                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'المقارنة بين الاربع قيم'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        footer: function (context) {
                                            return ` متوسط النتائج: ${barScore[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [lollipopChart],
                        data: {
                            labels: barGender.slice(0, 4), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(0, 4), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        pattern.draw(chapeOfFourValue[0], barColor[0]),
                                        barColor[1],
                                        barColor[2],
                                        barColor[3]
                                    ],
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    barPercentage: 0.05,
                                    fill: false,
                                }
                            ]
                        }
                    });

                    if (KPICode == "KPI-P-12") {
                        //prepare the KPI-12 area
                        $('#cards').append("<div class='row'><div class='chart-container col-md-11'><div class='col-md-6'> <canvas id='caseGraph'></canvas> </div><div class='col-md-6'>  <canvas id='termGraph'></canvas></div></div></div><br/> <div class='row'><div class= 'chart-container-main col-md-11'><canvas id='genderGraph'></canvas></div></div >");

                        //to sum the data of the two column bar char.
                        var arrayOfNumbers = barScore.map(Number);
                        var sum = arrayOfNumbers.slice(6, 12).map(function (num, idx) {
                            return num + arrayOfNumbers.slice(12, 18)[idx];
                        });

                        //drow KPI-12 graph
                        ctx = document.getElementById("termGraph"); //where in HTML
                        myChart = new Chart(ctx, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        },
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة اعداد الهيئة التعليمية من حيث الجنس:'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: function (context) {
                                                return `${barGender.slice(4, 6)[context[0].dataIndex]} `;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الهيئة التعليمية: ${numOfStudent.slice(4, 6)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة اعداد الهيئة التعليمية: ${barScore.slice(4, 6)[context[0].dataIndex]} % `;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(4, 6), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(4, 6), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[4],
                                            pattern.draw("dot", barColor[5])
                                        ],
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });
                        //need ..
                        ctx = document.getElementById("caseGraph"); //where in HTML
                        myChart = new Chart(ctx, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: false,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة اعداد الهيئة التعليمية من حيث الدرجة الاكادمية'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: function (context) {
                                                return `${barGender.slice(6, 12)[context[0].dataIndex]} `;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الهيئة التعليمية: ${numOfStudent.slice(6, 12)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة اعداد الهيئة التعليمية: ${barScore.slice(6, 12)[context[0].dataIndex]}% `;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(6, 12), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: sum, //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw("dot", "#D0DA32"),
                                            pattern.draw("ring", "#71BA44"),
                                            pattern.draw("dash", "#29B8BE"),
                                            pattern.draw("cross", "#1F3771"),
                                            pattern.draw("diamond", "#B0AEB3"),
                                            pattern.draw("box", "#F7931E")
                                        ],
                                        //   borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                        ctx = document.getElementById("genderGraph"); //where in HTML
                        myChart = new Chart(ctx, { /* chart */
                            type: 'bar',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: false,
                                        grid: {
                                            display: true

                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة اعداد الهيئة التعليمية من حيث الجنس والدرجة الاكاديمية'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: (context) => {
                                                return ` اعداد الهيئة التعليمية: ${context[0].raw.z} `;
                                            },
                                            footer: (context) => {
                                                return ` نسبة اعداد الهيئة التعليمية: ${context[0].raw.y} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(6, 12), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: [
                                            { x: barGender[12], z: numOfStudent[12], y: barScore[12] },
                                            { x: barGender[13], z: numOfStudent[13], y: barScore[13] },
                                            { x: barGender[14], z: numOfStudent[14], y: barScore[14] },
                                            { x: barGender[15], z: numOfStudent[15], y: barScore[15] },
                                            { x: barGender[16], z: numOfStudent[16], y: barScore[16] },
                                            { x: barGender[17], z: numOfStudent[17], y: barScore[17] }
                                        ], //y-axis
                                        label: "اناث", //the upper chart filter
                                        backgroundColor: barColor.slice(12, 18),
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    },
                                    {
                                        data: [
                                            { x: barGender[18], z: numOfStudent[18], y: barScore[18] },
                                            { x: barGender[19], z: numOfStudent[19], y: barScore[19] },
                                            { x: barGender[20], z: numOfStudent[20], y: barScore[20] },
                                            { x: barGender[21], z: numOfStudent[21], y: barScore[21] },
                                            { x: barGender[22], z: numOfStudent[22], y: barScore[22] },
                                            { x: barGender[23], z: numOfStudent[23], y: barScore[23] }
                                        ], //y-axis
                                        label: "ذكور", //the upper chart filter
                                        backgroundColor: barColor.slice(18, 24),
                                        // borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });
                    }

                    else if (KPICode == "KPI-P-13") {
                        //prepare the KPI-13 area
                        $('#cards').append("<div class='row'><div class= 'chart-container-main col-md-11'><canvas id='nationalityGraph'></canvas></div></div >");

                        //drow KPI-13 graph
                        ctx = document.getElementById("nationalityGraph"); //where in HTML
                        myChart = new Chart(ctx, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'نسبة اعداد اعضاء الهيئة التعليمية المستقيلين'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: function (context) {
                                                return `${barGender.slice(24, 26)[context[0].dataIndex]} `;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد اعضاء الهيئة التعليمية المستقيلين: ${numOfStudent.slice(24, 26)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة اعداد اعضاء الهيئة التعليمية المستقيلين: ${barScore.slice(24, 26)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(24, 26), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(24, 26), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            barColor[24],
                                            pattern.draw("dot", barColor[25])
                                        ],
                                        //borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });
                    }
                },
                error: function () {
                    alert(" القيم المختارة غير موجودة في قاعدة البيانات، الرجاء اعادة المحاولة")
                }
            });
        }

        if (KPICode == "KPI-P-14" || KPICode == "KPI-P-15" || KPICode == "KPI-P-16") {

            //prepare the area
            $('#cards').remove();
            $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div></div>");
            $('#cards').append("<div class='row'><div class= 'chart-container col-md-11'><div class='col-md-6'><canvas id='caseGraph'></canvas></div><div class='col-md-6'><canvas id='nationalityGraph'></canvas></div></div ></div>");

            $.ajax({
                type: "Get",
                url: "/Home/GetPublicationReportsChart",
                data: { programId: programId, KPICode: KPICode, gender: gender, year: year },
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var barColor = []; var barGender = []; var barScore = []; var progName = []; var numOfStudent = []; var chapeOfFourValue = [];
                    for (var i = 0; i < data.length; i++) {
                        barGender.push(data[i].gender);
                        barColor.push(data[i].nationality);
                        barScore.push(data[i].term);
                        splitText(barScore[i], 4);
                        progName.push(data[i].studentCase);
                        numOfStudent.push(data[i].programId);
                        chapeOfFourValue.push(data[i].year);
                    }

                    //prepare Cards Area

                    ctx = document.getElementById("target"); //where in HTML
                    myChart = new Chart(ctx, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        generateLabels: (chart) => {
                                            console.log(chart);
                                            //let visibility = [];
                                            //for (let i = 0; i < chart.data.label.length; i++)
                                            return ActualValueLabels.map(
                                                (label = ActualValueLabels, index) => ({
                                                    text: label,
                                                    fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                })
                                            )
                                        }

                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'المقارنة بين الاربع قيم لمعدل نشر اعضاء هيئة التدريس'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        afterFooter: (context) => {
                                            return `  معدل النشر: ${context[0].parsed.y} `
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [lollipopChart],
                        data: {
                            labels: barGender.slice(4, 8), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(4, 8), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        pattern.draw(chapeOfFourValue[4], barColor[4]),
                                        barColor[5],
                                        barColor[6],
                                        barColor[7]
                                    ],
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false,
                                    barPercentage: 0.05
                                }
                            ]
                        }
                    });
                    ctx = document.getElementById("nationalityGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'pie',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    max: 100,
                                    stacked: true,
                                    grid: {
                                        display: true

                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        usePointStyle: true
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'اعداد منشورات اعضاء هيئة التدريس من حيث الجنس'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        title: function (context) {
                                            return `${barGender.slice(2, 4)[context[0].dataIndex]} `;
                                        },
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد الناشرين: ${numOfStudent.slice(2, 4)[context[0].dataIndex]} `;
                                        },
                                        footer: function (context) {
                                            return ` نسبة اعداد المنشورات: ${barScore.slice(2, 4)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(2, 4), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(2, 4), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        barColor[2],
                                        pattern.draw("dot", barColor[3])
                                    ],
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });

                    ctx = document.getElementById("caseGraph"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'pie',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    max: 100,
                                    stacked: true,
                                    grid: {
                                        display: true

                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        usePointStyle: true
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'اعداد اعضاء هيئة التدريس الذين نشروا بحث واحد على الاقل'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        title: function (context) {
                                            return `${barGender.slice(0, 2)[context[0].dataIndex]} `;
                                        },
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        beforeFooter: function (context) {
                                            return ` اعداد الناشرين: ${numOfStudent.slice(0, 2)[context[0].dataIndex]} `;
                                        },
                                        footer: function (context) {
                                            return ` نسبة النشر: ${barScore.slice(0, 2)[context[0].dataIndex]} `;
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        data: {
                            labels: barGender.slice(0, 2), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(0, 2), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        barColor[0],
                                        pattern.draw("dot", barColor[1])
                                    ],
                                    //  borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false
                                }
                            ]
                        }
                    });
                },
                error: function () {
                    alert(" القيم المختارة غير موجودة في قاعدة البيانات، الرجاء اعادة المحاولة")
                }
            });
        }

        if (KPICode == "KPI-P-04" || KPICode == "KPI-P-05") {

            //prepare the area
            $('#cards').remove();
            $('#toAppendWith').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='target'></canvas></div></div></div>");

            $.ajax({
                type: "Get",
                url: "/Home/GetStudentssChart",
                data: { programId: programId, KPICode: KPICode, gender: gender, term: term, year: year },
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var barColor = []; var barGender = []; var barScore = []; var progName = []; var numOfStudent = []; var deffirantVal = []; var chapeOfFourValue = [];
                    for (var i = 0; i < data.length; i++) {
                        barGender.push(data[i].gender);
                        barColor.push(data[i].nationality);
                        barScore.push(data[i].term);
                        splitText(barScore[i], 4);
                        progName.push(data[i].studentCase);
                        chapeOfFourValue.push(data[i].year);
                        numOfStudent.push(data[i].programId)
                    }

                    //prepare Cards Area
                    ctx = document.getElementById("target"); //where
                    myChart = new Chart(ctx /* location */, { /* chart */
                        type: 'bar',
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    max: 100,
                                    stacked: true,
                                    grid: {
                                        display: true
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        generateLabels: (chart) => {
                                            console.log(chart);
                                            //let visibility = [];
                                            //for (let i = 0; i < chart.data.label.length; i++)
                                            return ActualValueLabels.map(
                                                (label = ActualValueLabels, index) => ({
                                                    text: label,
                                                    fillStyle: pattern.draw(ActualValueStyles[index], ActualValueColors[index])
                                                })
                                            )
                                        }

                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'المقارنة بين الاربع قيم لنسبة اعداد الطلاب في الدفعة'
                                },
                                tooltip: {
                                    yAlign: 'bottom',
                                    backgroundColor: '#636363',
                                    titleMarginBottom: 0,
                                    titleFont: {
                                        weight: 'bold',
                                        size: 16
                                    },
                                    titleSpacing: 0,
                                    titleAlign: 'center',
                                    bodyAlign: 'center',
                                    footerAlign: 'right',
                                    callbacks: {
                                        afterBody: function (context) {
                                            return '_______________________________';
                                        },
                                        afterFooter: (context) => {
                                            return `  نسبة الطلاب: ${context[0].parsed.y} %`
                                        },
                                        label: function (context) {
                                            return '';
                                        }
                                    }
                                }
                            }
                        },
                        plugins: [lollipopChart],
                        data: {
                            labels: barGender.slice(0, 4), //x-axis, and it can be ['','']
                            datasets: [
                                {
                                    data: barScore.slice(0, 4), //y-axis
                                    label: progName[0], //the upper chart filter
                                    backgroundColor: [
                                        pattern.draw(chapeOfFourValue[0], barColor[0]),
                                        barColor[1],
                                        barColor[2],
                                        barColor[3]
                                    ],
                                    // borderColor: "rgb(0,204,204)",
                                    borderWidth: 2,
                                    hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                    hoverBorderColor: "rgba(0,204,204,1)",
                                    fill: false,
                                    barPercentage: 0.05
                                }
                            ]
                        }
                    });
                    if (KPICode == "KPI-P-04") {
                        $('#cards').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='termGraph'></canvas></div></div></div>");

                        //prepare Cards Area
                        ctx = document.getElementById("termGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'نسبة الطلاب الذين تخرجوا في المدة المحددة'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الطلاب: ${numOfStudent.slice(6, 8)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة الطلاب: ${barScore.slice(6, 8)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },

                            data: {
                                labels: barGender.slice(6, 8), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(6, 8),
                                        //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw("dot", barColor[6]),
                                            barColor[8]
                                        ],
                                        //borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });

                    }
                    if (KPICode == "KPI-P-05") {
                        $('#cards').append("<div id='cards'><div class='row'><div class='chart-container-main col-md-11'><canvas id='caseGraph'></canvas></div></div></div>");

                        ctx = document.getElementById("caseGraph"); //where
                        myChart = new Chart(ctx /* location */, { /* chart */
                            type: 'pie',
                            options: {
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 100,
                                        stacked: true,
                                        grid: {
                                            display: true
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'نسبة الطلاب الذين اكملوا للسنة الثانية على نفس المسار'
                                    },
                                    tooltip: {
                                        yAlign: 'bottom',
                                        backgroundColor: '#636363',
                                        titleMarginBottom: 0,
                                        titleFont: {
                                            weight: 'bold',
                                            size: 16
                                        },
                                        titleSpacing: 0,
                                        titleAlign: 'center',
                                        bodyAlign: 'center',
                                        footerAlign: 'right',
                                        callbacks: {
                                            title: (context) => {
                                                return `${context[0].label}`;
                                            },
                                            afterBody: function (context) {
                                                return '_______________________________';
                                            },
                                            beforeFooter: function (context) {
                                                return ` اعداد الطلاب: ${numOfStudent.slice(4, 6)[context[0].dataIndex]} `;
                                            },
                                            footer: function (context) {
                                                return ` نسبة الطلاب: ${barScore.slice(4,6)[context[0].dataIndex]} %`;
                                            },
                                            label: function (context) {
                                                return '';
                                            }
                                        }
                                    }
                                }
                            },
                            data: {
                                labels: barGender.slice(4, 6), //x-axis, and it can be ['','']
                                datasets: [
                                    {
                                        data: barScore.slice(4, 6), //y-axis
                                        label: progName[0], //the upper chart filter
                                        backgroundColor: [
                                            pattern.draw("dot", barColor[4]),
                                            barColor[5]
                                        ],
                                        //borderColor: "rgb(0,204,204)",
                                        borderWidth: 2,
                                        hoverBackgroundColor: "rgba(0,204,204,0.4)",
                                        hoverBorderColor: "rgba(0,204,204,1)",
                                        fill: false
                                    }
                                ]
                            }
                        });
                        
                    }
                },
                error: function () {
                    alert(" القيم المختارة غير موجودة في قاعدة البيانات، الرجاء اعادة المحاولة")
                }
            });

        }
    }



</script>
